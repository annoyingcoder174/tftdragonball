<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Dragon Ball Sparkling Zero - Trang chÃ­nh</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="images/favicon.png" type="image/png">
    <script defer src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script defer src="scripts/firebaseConfig.js"></script>
    <script defer src="scripts/main.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <h1>Dragon Ball Sparkling Zero!</h1>

        <div class="controls">
            <label for="display-name">TÃªn hiá»ƒn thá»‹:</label>
            <input type="text" id="display-name" placeholder="Nháº­p tÃªn cá»§a báº¡n">
            <button id="join-table-btn" onclick="joinTable()">ğŸ“ Tham gia báº£ng Ä‘áº¥u</button>
            <button onclick="location.href='stats.html'">ğŸ“Š Xem thá»‘ng kÃª</button>
            <button id="leave-table-btn" style="display:none;" onclick="leaveTable()">ğŸšª Rá»i báº£ng</button>
        </div>

        <div id="post-join-buttons" style="display: none;" class="button-group">
            <button onclick="handleRollAugment()">ğŸ² Äá»•i lÃµi sá»©c máº¡nh</button>
            <button onclick="handleRollChamp()">ğŸ‘Š Äá»•i tÆ°á»›ng</button>
            <button onclick="resetShopUsage()">ğŸ›’ Äi Chá»£</button>
            <button onclick="location.href='roll.html'">ğŸ² MÃ¡y Quay ToÃ n NÄƒng</button>
        </div>


        <h2>Báº£ng Ä‘áº¥u hiá»‡n táº¡i</h2>
        <!-- Omni Calculator Button -->
        <button id="omniToggleBtn" style="position: fixed; bottom: 90px; right: 20px; z-index: 9999;">
            ğŸ“Š Omni Calculator
        </button>

        <!-- Omni Calculator Modal -->
        <div id="omniModal"
            style="display: none; position: fixed; bottom: 150px; right: 20px; background: #111; color: #fff; padding: 20px; border: 2px solid #00ffcc; border-radius: 10px; z-index: 9999; width: 300px; font-family: sans-serif;">
            <h3>MÃ¡y TÃ­nh Váº¡n NÄƒng</h3>
            <label>VÃ²ng Ä‘áº¥u: <input type="number" id="omniRound" min="1" /></label><br>
            <label>VÃ ng: <input type="number" id="omniGold" /></label><br>
            <label>Kinh nghiá»‡m: <input type="number" id="omniExp" /></label><br>
            <label>Äiá»ƒm sinh má»‡nh: <input type="number" id="omniHP" /></label><br>
            <label>+ Äiá»ƒm sinh má»‡nh:</label>
            <input type="number" id="omniHPBonus" value="0" min="0" style="width: 80px;"><br>
            <label>Chuá»—i tháº¯ng: <input type="number" id="omniWin" min="0" /></label><br>
            <label>Chuá»—i thua: <input type="number" id="omniLose" min="0" /></label><br>
            <label>Khoáº£ng cÃ¡ch tÆ°á»›ng (náº¿u thua): <input type="number" id="omniGap" min="0" /></label><br><br>
            <button onclick="calculateOmni()">ğŸ§  TÃ­nh</button>
            <div id="omniResult" style="margin-top: 10px; font-size: 14px;"></div>
        </div>


        <table id="augment-table">
            <h3>MÃ´i trÆ°á»ng</h3>
            <div id="environment-display">Äang táº£i...</div>

            <thead>
                <tr>
                    <th>NgÆ°á»i chÆ¡i</th>
                    <th>LÃµi Ä‘Ã£ chá»n</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <button onclick="location.href='history.html'">ğŸ“œ Xem lá»‹ch sá»­</button>
        <h2>Báº£ng Ä‘Ã£ tham gia</h2>
        <div id="previous-tables">Äang táº£i...</div>
    </div>


    <script>
        function handleRollAugment() {
            const user = firebase.auth().currentUser;
            if (user) {
                incrementAugmentRollCount(user.uid);
                location.href = 'rollAugment.html';
            }
        }

        function handleRollChamp() {
            const user = firebase.auth().currentUser;
            if (!user) return;

            const playerRef = firebase.firestore().collection("tables").doc("sharedTable").collection("players").doc(user.uid);

            // Clear level restrictions in Firestore
            playerRef.update({
                rollLevels: [], // Clear levels
                hasRolledOnce: false // Reset free roll status
            }).then(() => {
                console.log("ğŸ”„ Level restrictions and free rolls reset for user:", user.uid);
                // Clear local free roll tracking
                localStorage.removeItem("freeRollsUsed");
                sessionStorage.removeItem("freeRollsUsed");
                console.log("ğŸ”„ Free roll restrictions cleared locally");

                // Redirect to rollChamp.html
                location.href = "rollChamp.html";
            }).catch(error => {
                console.error("âŒ Error resetting levels:", error);
            });
        }



    </script>
</body>

</html>